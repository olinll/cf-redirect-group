# é™æ€é‡å®šå‘æœåŠ¡ (Static Redirect Service)

è¿™æ˜¯ä¸€ä¸ªåŸºäºå®¢æˆ·ç«¯ JavaScript å®ç°çš„ç®€å•é™æ€é‡å®šå‘æœåŠ¡ã€‚å®ƒå¯ä»¥éƒ¨ç½²åœ¨ GitHub Pagesã€Cloudflare Pages ç­‰é™æ€æ‰˜ç®¡æœåŠ¡ä¸Šï¼Œæ— éœ€è´­ä¹°æœåŠ¡å™¨ã€‚

## åŠŸèƒ½ç‰¹æ€§

*   **å®Œå…¨å…è´¹**: ä¾æ‰˜ GitHub Pages å’Œ Cloudflare Workers å…è´¹é¢åº¦ã€‚
*   **ä¸¤ç§é‡å®šå‘æ¨¡å¼**:
    *   **ç›´æ¥è·³è½¬**: è®¿é—®çŸ­é“¾ç›´æ¥è·³è½¬åˆ°ç›®æ ‡åœ°å€ã€‚
    *   **ä¸­é—´é¡µè·³è½¬**: æ˜¾ç¤ºä¸€ä¸ªå®‰å…¨æç¤ºå¡ç‰‡ï¼Œç”¨æˆ·éœ€ç‚¹å‡»â€œç»§ç»­è®¿é—®â€æ‰è·³è½¬ï¼ˆé€‚åˆå¤–éƒ¨æˆ–æ•æ„Ÿé“¾æ¥ï¼Œé˜²æ­¢è¯¯è§¦ï¼‰ã€‚
*   **è‡ªåŠ©åˆ›å»º**: æä¾› `/_url.html` ç•Œé¢ï¼Œå…è®¸è®¿å®¢è‡ªåŠ©åˆ›å»ºçŸ­é“¾ï¼ˆéœ€è¦å¯†ç æˆ–é…ç½® Tokenï¼‰ã€‚
*   **å®‰å…¨é˜²æŠ¤**:
    *   é˜² XSSã€é˜² HTML æ³¨å…¥ã€‚
    *   é˜²å¾ªç¯é‡å®šå‘ï¼ˆç¦æ­¢å¥—å¨ƒï¼‰ã€‚
    *   CSRF ä¿æŠ¤ã€‚
    *   ç›®æ ‡ URL æœ‰æ•ˆæ€§æ£€æŸ¥ï¼ˆæ­»é“¾æ— æ³•åˆ›å»ºï¼‰ã€‚
*   **è‡ªåŠ¨è¿‡æœŸ**: æ”¯æŒè®¾ç½®çŸ­é“¾æœ‰æ•ˆæœŸï¼ˆæœ€é•¿7å¤©ï¼‰ï¼Œè¿‡æœŸè‡ªåŠ¨æ¸…ç†ã€‚
*   **å‚æ•°ä¿ç•™**: æ”¯æŒé€ä¼  URL å‚æ•°ï¼ˆå¦‚ `?id=123`ï¼‰å’Œå“ˆå¸Œï¼ˆå¦‚ `#section`ï¼‰ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆå°ç™½æ•™ç¨‹ï¼‰

### ç¬¬ä¸€æ­¥ï¼šFork æœ¬ä»“åº“

ç‚¹å‡»å³ä¸Šè§’çš„ **Fork** æŒ‰é’®ï¼Œå°†æœ¬ä»“åº“å¤åˆ¶åˆ°ä½ è‡ªå·±çš„ GitHub è´¦å·ä¸‹ã€‚

### ç¬¬äºŒæ­¥ï¼šå¼€å¯ GitHub Pages

1.  è¿›å…¥ä½  Fork åçš„ä»“åº“ã€‚
2.  ç‚¹å‡» **Settings** -> **Pages**ã€‚
3.  åœ¨ **Build and deployment** ä¸‹ï¼Œ**Source** é€‰æ‹© `Deploy from a branch`ã€‚
4.  **Branch** é€‰æ‹© `main` åˆ†æ”¯ï¼Œæ–‡ä»¶å¤¹é€‰æ‹© `/ (root)`ã€‚
5.  ç‚¹å‡» **Save**ã€‚
6.  ç­‰å¾…å‡ åˆ†é’Ÿï¼Œä½ ä¼šè·å¾—ä¸€ä¸ªç±»ä¼¼ `https://ä½ çš„ç”¨æˆ·å.github.io/Static_Redirect_Group/` çš„ç½‘å€ã€‚

æ­¤æ—¶ï¼ŒåŸºç¡€çš„é‡å®šå‘åŠŸèƒ½å·²ç»å¯ç”¨äº†ï¼

---

## ğŸ› ï¸ è¿›é˜¶é…ç½®ï¼šå¼€å¯è‡ªåŠ©åˆ›å»ºçŸ­é“¾ (Cloudflare Worker)

å¦‚æœä½ æƒ³è®©åˆ«äººï¼ˆæˆ–è€…ä½ è‡ªå·±æ–¹ä¾¿åœ°ï¼‰é€šè¿‡ç½‘é¡µåˆ›å»ºçŸ­é“¾ï¼Œéœ€è¦éƒ¨ç½²ä¸€ä¸ª Cloudflare Workerã€‚

### 1. å‡†å¤‡å·¥ä½œ
*   æ³¨å†Œä¸€ä¸ª [Cloudflare](https://www.cloudflare.com/) è´¦å·ã€‚
*   åœ¨ GitHub ç”³è¯·ä¸€ä¸ª [Personal Access Token (Classic)](https://github.com/settings/tokens)ã€‚
    *   **Scopes** å‹¾é€‰ `repo` (ç»™äºˆè¯»å†™ä»“åº“æƒé™)ã€‚
    *   ä¿å­˜å¥½è¿™ä¸ª Tokenï¼Œ**ä¸è¦æ³„éœ²ç»™åˆ«äºº**ã€‚

### 2. åˆ›å»º Worker
1.  ç™»å½• Cloudflare Dashboardï¼Œç‚¹å‡»å·¦ä¾§ **Workers & Pages**ã€‚
2.  ç‚¹å‡» **Create Application** -> **Create Worker**ã€‚
3.  ç»™ Worker èµ·ä¸ªåå­—ï¼ˆä¾‹å¦‚ `my-short-link`ï¼‰ï¼Œç‚¹å‡» **Deploy**ã€‚
4.  ç‚¹å‡» **Edit code**ã€‚
5.  å°†æœ¬é¡¹ç›®ä¸­ `worker.js` çš„å†…å®¹å…¨éƒ¨å¤åˆ¶ï¼Œè¦†ç›– Cloudflare ç¼–è¾‘å™¨é‡Œçš„ä»£ç ã€‚
6.  ç‚¹å‡»å³ä¸Šè§’ **Save and deploy**ã€‚

### 3. é…ç½®ç¯å¢ƒå˜é‡
åœ¨ Worker çš„è®¾ç½®é¡µé¢ (**Settings** -> **Variables**) æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
| :--- | :--- | :--- |
| `GITHUB_TOKEN` | `ghp_xxxx...` | åˆšæ‰ç”³è¯·çš„ GitHub Token |
| `GITHUB_OWNER` | `ä½ çš„GitHubç”¨æˆ·å` | ä¾‹å¦‚ `afoim` |
| `GITHUB_REPO` | `ä½ çš„ä»“åº“å` | ä¾‹å¦‚ `Static_Redirect_Group` |
| `GITHUB_BRANCH` | `main` | åˆ†æ”¯åï¼Œé€šå¸¸æ˜¯ main |
| `BASE_DOMAIN` | `ä½ çš„çŸ­é“¾åŸŸå` | **é‡è¦ï¼** ç”¨äºå®‰å…¨æ£€æŸ¥ã€‚ä¾‹å¦‚ `u.2x.nz` æˆ– `ä½ çš„ç”¨æˆ·å.github.io` |

### 4. ç»‘å®šè·¯ç”± (å¯é€‰ä½†æ¨è)
å¦‚æœä½ æœ‰è‡ªå·±çš„åŸŸåæ‰˜ç®¡åœ¨ Cloudflareï¼š
1.  åœ¨ Worker -> **Triggers** -> **Custom Domains** ä¸­æ·»åŠ ä¸€ä¸ªå­åŸŸåï¼ˆå¦‚ `api.2x.nz`ï¼‰ã€‚
2.  æˆ–è€…åœ¨ä½ çš„ç½‘ç«™åŸŸåä¸‹æ·»åŠ  **Routes**ï¼Œä¾‹å¦‚ `example.com/api/create` æŒ‡å‘è¯¥ Workerã€‚

### 5. ä¿®æ”¹å‰ç«¯é…ç½®
ä¿®æ”¹ `_url.html` æ–‡ä»¶ï¼ˆå¯ä»¥ç›´æ¥åœ¨ GitHub ç½‘é¡µä¸Šç¼–è¾‘ï¼‰ï¼š
æ‰¾åˆ° `fetch('/api/create', ...)` è¿™ä¸€è¡Œï¼Œå°† `/api/create` æ›¿æ¢ä¸ºä½  Worker çš„å®é™…åœ°å€ï¼ˆä¾‹å¦‚ `https://my-short-link.ä½ çš„åå­—.workers.dev`ï¼‰ã€‚

---

## ğŸ“– æ–‡ä»¶ç»“æ„è¯´æ˜

*   `index.html` / `404.html`: å…¥å£æ–‡ä»¶ã€‚`404.html` æ˜¯æ ¸å¿ƒï¼Œåˆ©ç”¨ GitHub Pages æ‰¾ä¸åˆ°æ–‡ä»¶æ˜¾ç¤º 404 çš„æœºåˆ¶æ¥æ¥ç®¡è·¯ç”±ã€‚
*   `_url.html`: åˆ›å»ºçŸ­é“¾çš„å›¾å½¢åŒ–ç•Œé¢ã€‚
*   `js/config.js`: å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆè®¾ç½® Fallback é»˜è®¤è·³è½¬åœ°å€ï¼‰ã€‚
*   `js/rules_direct.js`: **ç›´æ¥è·³è½¬**çš„è§„åˆ™åˆ—è¡¨ï¼ˆæ‰‹åŠ¨ç»´æŠ¤ï¼‰ã€‚
*   `js/rules_intermediate.js`: **ä¸­é—´é¡µè·³è½¬**çš„è§„åˆ™åˆ—è¡¨ï¼ˆWorker è‡ªåŠ¨å†™å…¥è¿™é‡Œï¼‰ã€‚
*   `js/redirect.js`: æ ¸å¿ƒè·³è½¬é€»è¾‘ä»£ç ã€‚
*   `worker.js`: Cloudflare Worker åç«¯ä»£ç ã€‚

## âš™ï¸ æ‰‹åŠ¨é…ç½®è§„åˆ™

å¦‚æœä½ ä¸æƒ³ç”¨ Workerï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ JS æ–‡ä»¶æ¥æ·»åŠ è§„åˆ™ï¼š

**ä¿®æ”¹ `js/rules_direct.js` (ç›´æ¥è·³è½¬):**
```javascript
window.RULES_DIRECT = {
    "/my-link": {
        "url": "https://www.google.com",
        "expired_at": "" // å¯ç•™ç©ºï¼Œæˆ–å¡« "2025-12-31T23:59:59Z"
    }
};
```

**ä¿®æ”¹ `js/config.js` (é»˜è®¤å›é€€):**
```javascript
window.REDIRECT_CONFIG = {
    // å½“è®¿é—®çš„çŸ­é“¾ä¸å­˜åœ¨æ—¶ï¼Œè·³è½¬åˆ°å“ªé‡Œ
    fallback: "https://blog.acofork.com"
};
```

## ğŸ”’ å®‰å…¨è¯´æ˜

æœ¬é¡¹ç›®å·²é€šè¿‡å¤šé¡¹å®‰å…¨åŠ å›ºï¼š
*   âœ… **XSS é˜²æŠ¤**: ä¸¥æ ¼æ£€æŸ¥ URL åè®®ï¼Œç¦æ­¢ `javascript:` ç­‰æ¶æ„ä¼ªåè®®ã€‚
*   âœ… **CSRF é˜²æŠ¤**: Worker æ£€æŸ¥ Origin/Refererï¼Œé˜²æ­¢è¢«æ¶æ„ç«™ç‚¹ç›—åˆ·ã€‚
*   âœ… **å¾ªç¯ä¿æŠ¤**: ç¦æ­¢åˆ›å»ºæŒ‡å‘çŸ­é“¾æœåŠ¡è‡ªèº«çš„æ­»å¾ªç¯é“¾æ¥ã€‚

## â¤ï¸ èµåŠ©

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ [èµåŠ©æˆ‘](https://2x.nz) æˆ–ç»™ä¸€ä¸ª Star â­ï¸ï¼
